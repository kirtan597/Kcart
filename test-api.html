<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kcart API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-result { margin: 10px 0; padding: 15px; border-radius: 8px; border-left: 4px solid; }
        .success { background-color: #d4edda; color: #155724; border-color: #28a745; }
        .error { background-color: #f8d7da; color: #721c24; border-color: #dc3545; }
        .loading { background-color: #fff3cd; color: #856404; border-color: #ffc107; }
        button { padding: 12px 24px; margin: 8px; cursor: pointer; border: none; border-radius: 6px; font-weight: 500; transition: all 0.3s; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px; max-height: 300px; overflow-y: auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .status { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-left: 10px; }
        .status.online { background: #28a745; color: white; }
        .status.offline { background: #dc3545; color: white; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .card { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõí Kcart E-commerce API Test</h1>
            <p>Testing your deployed Netlify Functions at: <strong>https://kcartt.netlify.app</strong></p>
            <div id="api-status"></div>
        </div>
        
        <div class="grid">
            <div class="card">
                <h3>üõçÔ∏è Products API</h3>
                <p>Test product listing and filtering</p>
                <button class="btn-primary" onclick="testProducts()">Test Products</button>
            </div>
            <div class="card">
                <h3>üë§ User Registration</h3>
                <p>Test new user account creation</p>
                <button class="btn-primary" onclick="testUserRegister()">Test Register</button>
            </div>
            <div class="card">
                <h3>üîê User Login</h3>
                <p>Test user authentication</p>
                <button class="btn-primary" onclick="testUserLogin()">Test Login</button>
            </div>
            <div class="card">
                <h3>üõí Shopping Cart</h3>
                <p>Test cart add/update operations</p>
                <button class="btn-primary" onclick="testCart()">Test Cart</button>
            </div>
        </div>
        
        <div>
            <button class="btn-primary" onclick="runAllTests()">üöÄ Run All Tests</button>
            <button class="btn-primary" onclick="clearResults()">üóëÔ∏è Clear Results</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'https://kcartt.netlify.app/api';
        
        function addResult(message, type = 'loading') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
            return div;
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        async function checkApiStatus() {
            const statusDiv = document.getElementById('api-status');
            try {
                const response = await fetch(`${API_BASE}/product/list`);
                if (response.ok) {
                    statusDiv.innerHTML = '<span class="status online">API ONLINE</span>';
                } else {
                    statusDiv.innerHTML = '<span class="status offline">API OFFLINE</span>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<span class="status offline">API OFFLINE</span>';
            }
        }
        
        async function testProducts() {
            const resultDiv = addResult('üîç Testing Products API...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/product/list`);
                const data = await response.json();
                
                if (data.success && data.products && data.products.length > 0) {
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `
                        ‚úÖ <strong>Products API Working!</strong><br>
                        üì¶ Found ${data.products.length} products<br>
                        üìä Pagination: Page ${data.pagination.currentPage} of ${data.pagination.totalPages}<br>
                        <details>
                            <summary>View Sample Product</summary>
                            <pre>${JSON.stringify(data.products[0], null, 2)}</pre>
                        </details>
                    `;
                } else {
                    throw new Error('No products returned or API returned error');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `‚ùå <strong>Products API Failed:</strong> ${error.message}`;
            }
        }
        
        async function testUserRegister() {
            const resultDiv = addResult('üë§ Testing User Registration...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/user/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: 'Test User',
                        email: `test${Date.now()}@example.com`,
                        password: 'password123'
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.token) {
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `‚úÖ <strong>User Registration Working!</strong><br>üé´ Token: ${data.token.substring(0, 30)}...`;
                } else {
                    throw new Error(data.message || 'Registration failed');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `‚ùå <strong>User Registration Failed:</strong> ${error.message}`;
            }
        }
        
        async function testUserLogin() {
            const resultDiv = addResult('üîê Testing User Login...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/user/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'user@gmail.com',
                        password: '12345678'
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.token) {
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `‚úÖ <strong>User Login Working!</strong><br>üë§ User: ${data.user.name}<br>üé´ Token: ${data.token.substring(0, 30)}...`;
                } else {
                    throw new Error(data.message || 'Login failed');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `‚ùå <strong>User Login Failed:</strong> ${error.message}`;
            }
        }
        
        async function testCart() {
            const resultDiv = addResult('üõí Testing Cart API...', 'loading');
            
            try {
                // First add item to cart
                const addResponse = await fetch(`${API_BASE}/cart/add`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'token': 'demo_token_test'
                    },
                    body: JSON.stringify({
                        itemId: '1',
                        size: 'M'
                    })
                });
                
                const addData = await addResponse.json();
                
                if (addData.success) {
                    // Then get cart
                    const getResponse = await fetch(`${API_BASE}/cart/get`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'token': 'demo_token_test'
                        },
                        body: JSON.stringify({})
                    });
                    
                    const getData = await getResponse.json();
                    
                    if (getData.success) {
                        resultDiv.className = 'test-result success';
                        resultDiv.innerHTML = `
                            ‚úÖ <strong>Cart API Working!</strong><br>
                            üõí Items in cart: ${Object.keys(getData.cartData).length}<br>
                            <details>
                                <summary>View Cart Data</summary>
                                <pre>${JSON.stringify(getData.cartData, null, 2)}</pre>
                            </details>
                        `;
                    } else {
                        throw new Error('Failed to get cart');
                    }
                } else {
                    throw new Error('Failed to add to cart');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `‚ùå <strong>Cart API Failed:</strong> ${error.message}`;
            }
        }
        
        async function runAllTests() {
            clearResults();
            addResult('üöÄ Running all API tests...', 'loading');
            
            await testProducts();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testUserLogin();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testUserRegister();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testCart();
            
            addResult('‚úÖ All tests completed!', 'success');
        }
        
        // Check API status and auto-test products on load
        window.onload = async () => {
            await checkApiStatus();
            await testProducts();
        };
    </script>
</body>
</html>